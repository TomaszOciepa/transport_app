<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Transport App" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC7GlH-DOckBL4CYmu2hpzIJ2Kj7q30eJw&libraries=places&language=pl&callback=initAutocomplete">
</script>

<script>
  function initAutocomplete() {
    // Pole odbioru
    const pickupInput = document.getElementById("order_pickup_address");
    const pickupLat = document.getElementById("pickup_lat");
    const pickupLon = document.getElementById("pickup_lon");

    if (pickupInput) {
      const pickupAutocomplete = new google.maps.places.Autocomplete(pickupInput, {
        types: ["geocode"],
        componentRestrictions: { country: "pl" }
      });

      pickupAutocomplete.addListener("place_changed", function () {
        const place = pickupAutocomplete.getPlace();
        if (place.geometry) {
          pickupLat.value = place.geometry.location.lat();
          pickupLon.value = place.geometry.location.lng();
        }
      });
    }

    // Pole dostawy
    const deliveryInput = document.getElementById("order_delivery_address");
    const deliveryLat = document.getElementById("delivery_lat");
    const deliveryLon = document.getElementById("delivery_lon");

    if (deliveryInput) {
      const deliveryAutocomplete = new google.maps.places.Autocomplete(deliveryInput, {
        types: ["geocode"],
        componentRestrictions: { country: "pl" }
      });

      deliveryAutocomplete.addListener("place_changed", function () {
        const place = deliveryAutocomplete.getPlace();
        if (place.geometry) {
          deliveryLat.value = place.geometry.location.lat();
          deliveryLon.value = place.geometry.location.lng();
        }
      });
    }
  }
</script>

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>
  <body>
    <nav class="navbar navbar-light bg-light shadow-sm mb-4">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="<%= root_path %>">
          <i class="bi bi-house-door-fill fs-4 me-2"></i>
          Transport App
        </a>
      </div>
    </nav>
    <%= yield %>

      <footer class="bg-dark text-white text-center py-4 mt-5">
        <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center">
          <span>&copy; <%= Time.current.year %> TransportApp. Wszystkie prawa zastrze≈ºone.</span>
          <div class="mt-2 mt-md-0">
            <a href="#" class="text-white me-3"><i class="bi bi-facebook fs-5"></i></a>
            <a href="#" class="text-white me-3"><i class="bi bi-twitter fs-5"></i></a>
            <a href="#" class="text-white"><i class="bi bi-instagram fs-5"></i></a>
          </div>
        </div>
    </footer>
  </body>
</html>
