<div class="container my-4">
  <h2 class="fw-bold mb-4">Edytuj zamówienie <span class="text-primary">#<%= @order.order_number %></span></h2>

  <%= form_with model: @order, url: dispatcher_order_path(@order), method: :patch, local: true do |f| %>
    <div class="card shadow-sm rounded-4 p-4 position-relative">
      <small class="text-muted position-absolute top-0 end-0 m-3">
        Utworzono: <%= l(@order.created_at, format: :long) %>
      </small>

      <h5 class="mb-3 border-bottom pb-2"><i class="bi bi-info-circle me-2"></i>Dane podstawowe</h5>

      <div class="row mb-3">
        <div class="col-md-6 mb-2">
          <%= f.label :status, "Status", class: "form-label fw-bold" %>
          <%= f.select :status,
            [
              ["Oczekujące", "pending"],
              ["Zaplanowane", "scheduled"],
              ["W trasie", "in_transit"],
              ["Zakończone", "completed"],
              ["Anulowane", "canceled"]
            ],
            {}, 
            class: "form-select"
          %>
        </div>

        <div class="col-md-6 mb-2">
            <%= f.label :service_type_id, "Typ usługi", class: "form-label fw-bold" %>
            <%= f.select :service_type_id,
                    @service_types.map { |s| [s.name, s.id] },
                    { selected: @order.service_type_id },
                    class: "form-select"
            %>
        </div>
        
        <div class="col-md-6 mb-2">
            <%= f.label :vehicle_type_id, "Typ pojazdu", class: "form-label fw-bold" %>
            <%= f.select :vehicle_type_id,
                    @vehicle_types.map { |v| [v.name, v.id] },
                    { selected: @order.vehicle_type_id },
                    class: "form-select"
            %>
        </div>

        <div class="col-md-6 mb-2">
          <p><strong>Data załadunku:</strong> <%= l(@order.pickup_date, format: :long) if @order.pickup_date %></p>
        </div>
        <div class="col-md-6 mb-2">
          <p><strong>Data dostawy:</strong> <%= l(@order.delivery_date, format: :long) if @order.delivery_date %></p>
        </div>
        <div class="col-md-6 mb-2">
          <p><strong>Czas przejazdu:</strong> <%= @order.travel_time.round(2) if @order.travel_time %> h</p>
        </div>
        <div class="col-md-6 mb-2">
          <p><strong>Odległość:</strong> <%= number_with_precision(@order.distance_km, precision: 2) %> km</p>
        </div>
        <div class="col-md-6 mb-2">
          <p><strong>Adres załadunku:</strong> <%= @order.pickup_address %></p>
        </div>
        <div class="col-md-6 mb-2">
          <p><strong>Adres dostawy:</strong> <%= @order.delivery_address %></p>
        </div>
        <div class="col-md-6 mb-2">
          <p><strong>Cena:</strong> <%= number_to_currency(@order.price, unit: "PLN ", precision: 2) %></p>
        </div>
        <div class="col-md-6 mb-2">
          <p><strong>Klient:</strong> <%= @order.user.email %></p>
        </div>
      </div>
    </div>

    <div class="mt-3 d-flex justify-content-start">
      <%= f.submit "Zapisz zmiany", class: "btn btn-dark rounded-pill px-4 py-2 shadow-sm me-2" %>
      <%= link_to "Anuluj", dispatcher_order_path(@order), class: "btn btn-outline-secondary rounded-pill px-4 py-2 shadow-sm" %>
    </div>
  <% end %>
</div>
