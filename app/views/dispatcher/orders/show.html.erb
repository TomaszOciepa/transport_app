<div class="container my-4">
  <h2 class="fw-bold mb-4">Zamówienie <span class="text-primary">#<%= @order.order_number %></span></h2>

  <div class="card shadow-sm rounded-4 p-4 position-relative">
    <small class="text-muted position-absolute top-0 end-0 m-3">
      Utworzono: <%= l(@order.created_at, format: :long) %>
    </small>

    <h5 class="mb-3 border-bottom pb-2"><i class="bi bi-info-circle me-2"></i>Dane podstawowe</h5>

    <div class="row mb-3">
      <div class="col-md-6 mb-2">
        <p><strong>Status:</strong> 
          <span class="badge <%= case @order.status
                                   when 'pending' then 'bg-warning text-dark'
                                   when 'scheduled' then 'bg-primary'
                                   when 'in_transit' then 'bg-info text-dark'
                                   when 'completed' then 'bg-success'
                                   when 'canceled' then 'bg-danger'
                                   else 'bg-secondary'
                                 end %>">
            <%= @order.status_name || "Brak statusu" %>
          </span>
        </p>
      </div>
       <div class="col-md-6 mb-2">
        <p><strong>Typ usługi:</strong> <%= @order.service_type.name %></p>
      </div>
      <div class="col-md-6 mb-2">
        <p><strong>Typ pojazdu:</strong> <%= @order.vehicle_type.name %></p>
      </div>
      <div class="col-md-6 mb-2">
        <p><strong>Data załadunku:</strong> <%= l(@order.pickup_date, format: :long) if @order.pickup_date %></p>
      </div>
      <div class="col-md-6 mb-2">
        <p><strong>Data dostawy:</strong> <%= l(@order.delivery_date, format: :long) if @order.delivery_date %></p>
      </div>
      <div class="col-md-6 mb-2">
        <p><strong>Czas przejazdu:</strong> <%= @order.travel_time.round(2) if @order.travel_time %> h</p>
      </div>
      <div class="col-md-6 mb-2">
        <p><strong>Odległość:</strong> <%= number_with_precision(@order.distance_km, precision: 2) %> km</p>
      </div>
      <div class="col-md-6 mb-2">
        <p><strong>Adres załadunku:</strong> <%= @order.pickup_address %></p>
      </div>
      <div class="col-md-6 mb-2">
        <p><strong>Adres dostawy:</strong> <%= @order.delivery_address %></p>
      </div>
      <div class="col-md-6 mb-2">
        <p><strong>Cena:</strong> <%= number_to_currency(@order.price, unit: "PLN ", precision: 2) %></p>
      </div>
      <div class="col-md-6 mb-2">
        <p><strong>klient:</strong> <%= @order.user.email %></p>
      </div>
       <div class="col-md-6 mb-2">
        <p><strong>Kierowca:</strong>
          <% if @order.driver %>
            <%= link_to "#{@order.driver.first_name} #{@order.driver.last_name}", dispatcher_driver_path(@order.driver), class: "text-decoration-none" %>
          <% else %>
            Brak przypisanego kierowcy
          <% end %>
        </p>
      </div>
      <div class="col-md-6 mb-2">
        <p><strong>Pojazd:</strong>
          <% if @order.vehicle %>
            <%= link_to "#{@order.vehicle.brand} - #{@order.vehicle.registration_number}", dispatcher_vehicle_path(@order.vehicle), class: "text-decoration-none" %>
          <% else %>
            Brak przypisanego pojazdu
          <% end %>
        </p>
      </div>

    </div>
  </div>

  <div class="mt-3 d-flex justify-content-start">
    <%= link_to "Powrót do listy", dispatcher_orders_path, class: "btn btn-dark rounded-pill px-4 py-2 shadow-sm me-2" %>
    <%= link_to "Edytuj", edit_dispatcher_order_path(@order), class: "btn btn-outline-secondary rounded-pill px-4 py-2 shadow-sm" %>
    <%= link_to "Usuń", dispatcher_order_path(@order),
            data: { turbo_method: :delete, turbo_confirm: "Czy na pewno chcesz usunąć zamówienie?" },
            class: "btn btn-outline-secondary rounded-pill px-4 py-2 shadow-sm" %>
    
    <% if @order.driver.nil? && @order.vehicle.nil? %>
      <%= link_to "Przypisz pojazd i kierowcę", assign_dispatcher_order_path(@order),
            class: "btn btn-primary rounded-pill px-4 py-2 shadow-sm" %>
    <% end %>
  </div>
</div>
