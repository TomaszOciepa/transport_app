
<% content_for :head do %>
  <script async defer data-turbo-track="reload"
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC7GlH-DOckBL4CYmu2hpzIJ2Kj7q30eJw&libraries=places&language=pl&callback=googleMapsLoaded">
  </script>
  <script>
    window.googleMapsLoaded = function() {
      document.dispatchEvent(new Event("google-maps-loaded"));
    };
  </script>
<% end %>

<div class="container py-5" data-controller="autocomplete"
     data-autocomplete-pickup-target="pickup"
     data-autocomplete-pickup-lat-target="pickupLat"
     data-autocomplete-pickup-lon-target="pickupLon"
     data-autocomplete-delivery-target="delivery"
     data-autocomplete-delivery-lat-target="deliveryLat"
     data-autocomplete-delivery-lon-target="deliveryLon">

  <div class="row justify-content-center">
    <div class="col-lg-10">
      <h3 class="mb-4 fw-bold text-start">Oblicz cenę transportu</h3>

      <div class="card shadow-lg rounded-4 border-0">
        <div class="card-body p-5">
          <%= form_with(model: @order, url: preview_orders_path, local: true, id: "order-form", data: { turbo: false }) do |f| %>

            <!-- Dane odbioru i dostawy -->
            <div class="bg-light rounded-3 p-4 mb-4">
              <h5 class="fw-bold mb-4">Dane odbioru i dostawy</h5>

              <div class="mb-4">
                <%= f.label :pickup_address, "Odbiór", class: "form-label fw-bold" %>
                <%= f.text_field :pickup_address,
                                 class: "form-control form-control-lg",
                                 placeholder: "np. Warszawa, Marszałkowska 1",
                                 required: true,
                                 data: { autocomplete_target: "pickup" } %>
                <%= f.hidden_field :pickup_lat, id: "pickup_lat", data: { autocomplete_target: "pickupLat" } %>
                <%= f.hidden_field :pickup_lon, id: "pickup_lon", data: { autocomplete_target: "pickupLon" } %>
              </div>

              <div class="mb-4">
                <%= f.label :delivery_address, "Dostawa", class: "form-label fw-bold" %>
                <%= f.text_field :delivery_address,
                                 class: "form-control form-control-lg",
                                 placeholder: "np. Kraków, Długa 10",
                                 required: true,
                                 data: { autocomplete_target: "delivery" } %>
                <%= f.hidden_field :delivery_lat, id: "delivery_lat", data: { autocomplete_target: "deliveryLat" } %>
                <%= f.hidden_field :delivery_lon, id: "delivery_lon", data: { autocomplete_target: "deliveryLon" } %>
              </div>
            </div>

            <!-- Wybierz typ pojazdu -->
            <div class="bg-light rounded-3 p-4 mb-4">
              <h5 class="fw-bold mb-4">Wybierz typ pojazdu</h5>
              <div class="d-flex flex-wrap gap-3 mb-4">
                <% @vehicle_types.each do |vehicle| %>
                  <label>
                    <%= f.radio_button :vehicle_type_id, vehicle.id, class: "btn-check", autocomplete: "off", required: true %>
                    <span class="btn vehicle-btn p-4 text-center" style="min-width: 120px;">
                      <i class="bi bi-truck display-5"></i>
                      <div class="mt-2"><%= vehicle.name %></div>
                      <small><%= number_to_currency(vehicle.price_per_km, unit: "PLN") %>/km</small>
                    </span>
                  </label>
                <% end %>
              </div>
            </div>

            <!-- Wybierz typ usługi -->
            <div class="bg-light rounded-3 p-4 mb-4">
              <h5 class="fw-bold mb-4">Wybierz typ usługi</h5>
              <div class="d-flex flex-wrap gap-3 mb-4">
                <% @service_types.each do |service| %>
                  <label>
                    <%= f.radio_button :service_type_id, service.id, class: "btn-check", autocomplete: "off", required: true %>
                    <span class="btn btn-outline-secondary rounded-pill px-4 py-2"><%= service.name %></span>
                  </label>
                <% end %>
              </div>

              <div class="mb-4">
                <%= f.label :pickup_date, "Data i godzina odbioru", class: "form-label fw-bold" %>
                <%= f.datetime_local_field :pickup_date, class: "form-control form-control-lg", required: true %>
              </div>

              <div class="d-flex justify-content-end mt-4">
                <%= f.submit "Oblicz koszt", class: "btn btn-lg btn-dark px-5 rounded-pill shadow-sm custom-submit" %>
              </div>
            </div>

          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>


